h1("Profile"),
h3("Select a Country to Learn about its Adolescent and Youth Data"), '<br/>', '<br/>'
)
),
fluidRow(
column(6,
wellPanel(
selectInput("country",
"Select Country",
choices = as.list(aypopdata.long$Country))
)
),
column(6,
)),
fluidRow(
HTML(
paste(
h3("Adolescent & Youth Population"), uiOutput("info0"), '<br/>'
)
),
column(8,
plotOutput("graph", width = "75%", height = "150px")
),
column(4,
),
downloadButton("downloadGraph", "Download Graph")
),
# fluidRow(
#   column(8,
#          plotOutput("wide", width = "100%", height = "150px")
#   ),
#   column(4,
#   ),
# ),
fluidRow(
HTML( paste(h3("Key Life Events"),uiOutput("info0a"), '<br/>')
),
column(8,
plotOutput("linegraph", width = "75%", height = "200px")
),
column(4,
tableOutput("table")
),
),
fluidRow(
HTML(
paste(
h3("Prevalence of Sexual Activity in the Last Month"), '<br/>'
)
),
column(6, uiOutput("infoRecent"),
plotOutput("sex_activity_graph", width = "60%", height = "200px")
),
column(6, uiOutput("infoNever"),
plotOutput("never_sex_graph", width = "60%", height = "200px")
),
),
fluidRow(
HTML( paste(h3("Modern Contraceptive Method Prevalence"), '<br/>')
),
column(4,uiOutput("infoUnMarr"),
plotOutput("mod_con", width = "60%", height = "200px")
),
column(4,uiOutput("infoMarr"),
plotOutput("mod_marr",  width = "60%", height = "200px")
),
column(4, uiOutput("infoCondom"),
plotOutput("con_use", width = "60%", height = "120px")
),
),
fluidRow(
HTML( paste(h3("Traditional Contraceptive Method Prevalence"), '<br/>')
),
column(6,uiOutput("infoTUnmarr"),
plotOutput("trad_unmarr", width = "60%", height = "200px")
),
column(6, uiOutput("infoTMarr"),
plotOutput("trad_marr", width = "60%", height = "200px")
),
),
fluidRow(
HTML( paste(h5("More Info"), '<br/>')
),
column(12,
tags$h1(""), "If you woud like to learn more, the A&Y Data Set used to create this App can be found on the ",
tags$a(href = "https://www.familyplanning2020.org/ayfp", "FP2020 Site"),
tags$h2(""), "The code used to create this App can be found on our",
tags$a(href = "https://github.com/familyplanning2020/FP2020AYApp", "GitHub Account")
),
)
),
#builds Tab for Compare Page
tabPanel("Compare",
HTML(
paste(
h1("Compare"),
h3("Select Up to 4 Countries to Compare its Adolescent and Youth Data"), '<br/>', '<br/>'
)
),
fluidRow(
column(6,
wellPanel(
selectizeInput("country",
"Select Up to 4 Countries to Compare",
choices = as.list(aypopdata.long$Country),
multiple = TRUE,
options = list(maxItems = 4))
)
),
column(6,
)),
fluidRow(
HTML(paste(h5("More Info"), '<br/>')
),
column(12,
tags$h1(""), "If you woud like to learn more, the A&Y Data Set used to create this App can be found on the ",
tags$a(href = "https://www.familyplanning2020.org/ayfp", "FP2020 Site"),
tags$h2(""), "The code used to create this App can be found on our",
tags$a(href = "https://github.com/familyplanning2020/FP2020AYApp", "GitHub Account")
),
)
),
#builds Tab for Analyze Page
tabPanel("Analyze",
HTML(
paste(
h1("Analzye"),
h3("Info"), '<br/>', '<br/>'
)
),
fluidRow(
HTML(paste(h5("More Info"), '<br/>')
),
column(12,
tags$h1(""), "If you woud like to learn more, the A&Y Data Set used to create this App can be found on the ",
tags$a(href = "https://www.familyplanning2020.org/ayfp", "FP2020 Site"),
tags$h2(""), "The code used to create this App can be found on our",
tags$a(href = "https://github.com/familyplanning2020/FP2020AYApp", "GitHub Account")
),
)
)
)
# Draw Bargraphs and Figures
server <- function(input, output) {
output$instructions <- renderText("Some text")
#Information Buttons
output$info0 <- renderUI({
tags$span(
popify(bsButton("info0", "What is this?", size = "extra-small"),
"Definition",
"Total and Percentage of 10-14, 15-19, and 20-24 out of women aged 10-49. Women aged 15-49 are considered women of reproductive age. Blue represents 10-14, light green represents 15-19, and dark green represents 20-24."),
)
})
output$info0a <- renderUI({
tags$span(
popify(bsButton("info0a", "What is this?", size = "extra-small"),
"Definition",
"Order of key life events that indicate when most adolescents and young people first marry, engage in sex, give birth. Yellow represents first marriage, orange represents first sex, and purple represents first birth."),
)
})
output$infoTUnmarr <- renderUI({
tags$span(
popify(bsButton("infoTUnMarr", "What is this?", size = "extra-small"),
"Definition",
"Percentage of unmarried sexually active women using a traditional contraceptive method. Light green represents 15-19 and dark green represents 20-24."),
)
})
output$infoTMarr <- renderUI({
tags$span(
popify(bsButton("infoTMarr", "What is this?", size = "extra-small"),
"Definition",
"Percentage of married women using a traditional contraceptive method. Light green represents 15-19, pale pink represents 15-24, and dark green represents 20-24."),
)
})
output$infoNever <- renderUI({
tags$span(
popify(bsButton("infoNever", "What is this?", size = "extra-small"),
"Definition",
"Percentage of women who never had intercourse. Light green represents 15-19 and dark green represents 20-24."),
)
})
output$infoRecent <- renderUI({
tags$span(
popify(bsButton("infoRecent", "What is this?", size = "extra-small"),
"Definition",
"Percentage of women who were sexually activity in the four weeks preceding the survey. Light green represents 15-19 and dark green represents 20-24."),
)
})
output$infoUnMarr <- renderUI({
tags$span(
popify(bsButton("infoUnMarr", "What is this?", size = "extra-small"),
"Definition",
"Percentage of unmarried sexually active women age 15-24 who reported using a modern contraceptive method. Light green represents 15-19 and dark green represents 20-24."),
)
})
output$infoMarr <- renderUI({
tags$span(
popify(bsButton("infoMarr", "What is this?", size = "extra-small"),
"Definition",
"Percentage of married women age 15-24 who reported using a modern contraceptive method. Light green represents 15-19, pale pink represents 15-24, and dark green represents 20-24."),
)
})
output$infoCondom <- renderUI({
tags$span(
popify(bsButton("infoCondom", "What is this?", size = "extra-small"),
"Definition",
"Percentage of young women age 15-24 who reported using a condom at last sexual intercourse, of all young women who had sex with more than one partner in the 12 months preceding the survey. Pale pink represents 15-24."),
)
})
#Code for Information Buttons End
#Start Code for Graphs
#New Plot: Population by Age Groups
ay_res <- reactive({
res <- aypopdata.long %>% filter(aypopdata.long$Country == input$country)
req(nrow(res) > 0)
res
})
output$graph <- renderPlot({
bar_one <- (ggplot(ay_res(), aes(Country, Count, fill = Age_Group)) + geom_bar(stat = "identity") +
geom_text(aes(label=paste0(Count,"%", " ", "(", (round(Round_Total/1000000,1))," ", "Million", ")")), color="black", size=3.5, position = position_stack(vjust = 0.5)))
bar_one + theme_classic()  +labs(subtitle = "Adolescents and Youth") +
scale_fill_manual(values = cbp2, labels = c("Young Adolescents (10-14)", "Older Adolescents (15-19)","Older Youth (20-24)"), name = "Age Group") +
theme(axis.line.y=element_blank(),
axis.text.y=element_blank(),
axis.title.y=element_blank(),
axis.title.x = element_blank(),
axis.ticks.y=element_blank(),
axis.text.x =element_blank(),
axis.ticks.x =element_blank(),
axis.line.x =element_blank(),
legend.position = "right")+
coord_flip()+ scale_y_reverse()
output$downloadGraph <- downloadHandler(
filename = function() {
paste("Adolescents and Youth", "png", sep = ".")
},
content = function(file) {
png(file)
(bar_one <- (ggplot(ay_res(), aes(Country, Count, fill = Age_Group)) + geom_bar(stat = "identity") +
geom_text(aes(label=paste0(Count,"%", " ", "(", (round(Round_Total/1000000,1))," ", "Million", ")")), color="black", size=3.5, position = position_stack(vjust = 0.5)))
bar_one + theme_classic()  +labs(subtitle = "Adolescents and Youth") +
scale_fill_manual(values = cbp2, labels = c("Young Adolescents (10-14)", "Older Adolescents (15-19)","Older Youth (20-24)"), name = "Age Group") +
theme(axis.line.y=element_blank(),
axis.text.y=element_blank(),
axis.title.y=element_blank(),
axis.title.x = element_blank(),
axis.ticks.y=element_blank(),
axis.text.x =element_blank(),
axis.ticks.x =element_blank(),
axis.line.x =element_blank(),
legend.position = "right")+
coord_flip()+ scale_y_reverse()
)
dev.off()
},
)
})
#End Plot
#New Plot: Women of Reproductive Age
# small_ay_res <- reactive({
#   res1 <- aypopdata %>% filter(aypopdata$Country == input$country)
#   req(nrow(res1) > 0)
#   res1
# })
#
# output$wide <- renderPlot({
#
#   bartwo <- (ggplot(small_ay_res(), aes(Country, `Women of Reproductive Age (15-49)`)) +
#                geom_bar(stat = "identity", fill = "#7294D4") +
#                labs(subtitle = "Women of Reproductive Age (15-49)")  +
#                geom_text(aes(label=paste0((round(Round_Count_WRA/1000000,1))," ", "Million")), color="black", size=3.50, hjust = 5.0))
#
#   bartwo + theme_classic() + coord_flip()  + theme(axis.line.y=element_blank(),
#                                                    axis.text.y=element_blank(),
#                                                    axis.title.x=element_blank(),
#                                                    axis.title.y=element_blank(),
#                                                    axis.ticks.y=element_blank(),
#                                                    axis.text.x =element_blank(),
#                                                    axis.ticks.x =element_blank(),
#                                                    axis.line.x =element_blank(),
#                                                    legend.position = "bottom")
#
# })
### END PLOT
#NEW PLOT: Table
kle_mar_res <- reactive({
res3 <- kle_marriage %>% filter(kle_marriage$Country == input$country)
req(nrow(res3) > 0)
table1 <- matrix(c(res3[[1,2]], NA, res3[[1,3]], res3[[1,4]], res3[[1,5]], NA, NA, res3[[1,6]]), ncol = 2, byrow = TRUE)
colnames(table1) <- c("% Married", "% Married before 18 Years Old")
rownames(table1) <- c("15-19", "20-24", "25-29","15-24")
table2 <- as.matrix(table1)
`Age Group`=c("15-19", "20-24", "25-29","15-24")
table2=cbind(`Age Group`, table2)
table2
})
output$table <- renderTable(kle_mar_res(),hover =TRUE, bordered = TRUE, colnames= TRUE,digits = 1)
#NEW PLOT:Recent Sexual Activity
ayfp_sex_res <- reactive({
res4 <- ayfp %>% select(2,6,7)  %>% filter(ayfp$Country == input$country)
req(nrow(res4) > 0)
res4$"15-19" <- res4$"Recent sex older adolescents aged 15-19"
res4$"20-24" <- res4$"Recent sex older youth aged 20-24"
res4 <- res4[,-1:-3]
res4.long <- res4 %>% gather("Age.Group", "Percent", "15-19" , "20-24")
res4.long
})
output$sex_activity_graph <- renderPlot({
validate(
need(nrow(ayfp_sex_res()) > 0, "No data for this selection.")
)
fig <- (ggplot(ayfp_sex_res(), aes(x= reorder(`Age.Group`, -`Percent`), y = `Percent`, fill = `Age.Group`)) + geom_bar(stat = "identity"))
fig + coord_flip() + theme_classic() +
geom_text(aes(label=`Percent`), color="black", size=3.5) +
scale_fill_manual(values = cbp3, name = "Age Group") +
labs(title = "Sexual Activity %") + theme(axis.line.y=element_blank(),
axis.text.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.ticks.y=element_blank(),
axis.text.x =element_blank(),
axis.ticks.x =element_blank(),
axis.line.x =element_blank(),
legend.position = "bottom")
})
#END PLOT
#NEW PLOT: Ever Sexual Activity
ayfp_never_res <- reactive({
res5 <- ayfp %>% select(2,4,5) %>% filter(ayfp$Country == input$country)
req(nrow(res5) > 0)
ayfp_never_res
res5$"15-19" <- res5$"Never have had sex older adolescents aged 15-19"
res5$"20-24" <- res5$"Never have had sex older youth aged 20-24"
res5.long <- res5 %>% gather("Age.Group", "Percent", "15-19", "20-24")
res5.long
})
output$never_sex_graph <- renderPlot({
fig <- (ggplot(ayfp_never_res(), aes(x= reorder(`Age.Group`,`Percent`), y = `Percent`, fill = `Age.Group`)) + geom_bar(stat = "identity"))
fig + coord_flip() + theme_classic() +
geom_text(aes(label=`Percent`), color="black", size=3.5) + scale_fill_manual(values = cbp3, name = "Age Group") +
labs(title= "Never Had Sex %") + theme(axis.line.y=element_blank(),
axis.text.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.ticks.y=element_blank(),
axis.text.x =element_blank(),
axis.ticks.x =element_blank(),
axis.line.x =element_blank(),
legend.position = "bottom")
})
#END PLOT
#NEW PLOT
#timeline of key life events
kle_age_res <- reactive({
res2 <- kle_age %>% filter(kle_age$Country == input$country)
req(nrow(res2) > 0)
res2.long <- res2 %>% gather(Event, Age, `First Marriage`,`First Sex`, `First Birth`)
res2.long$Event<- factor(res2.long$Event, levels = c("First Marriage", "First Sex", "First Birth"))
res2.long
})
output$linegraph <- renderPlot({
#Create Plot
timeline_plot<- ggplot(kle_age_res(), aes(x=Age, y=0, col=Event, label=Event))
timeline_plot<- timeline_plot +
theme_classic() +
labs(col="Events") +
scale_color_manual(values = cbp1) + xlim(15, 25)
timeline_plot<- timeline_plot + geom_hline(yintercept=0, color = "black", size=1)
timeline_plot<- timeline_plot + geom_point(aes(y=0), size=6)
timeline_plot<- timeline_plot + theme(axis.line.y=element_blank(),
axis.text.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.ticks.y=element_blank(),
axis.text.x =element_blank(),
axis.ticks.x =element_blank(),
axis.line.x =element_blank(),
legend.position = "right"
)
timeline_plot <- timeline_plot +
geom_text(aes (x = Age, y = -0.05, label = Age), size = 3.5, color = "black",check_overlap = TRUE) +
geom_text(aes (x = Age, y = 0.1, label = ""), size = 3.5)
#ggtitle("Median Age at First Marriage, Sex and Birth")
timeline_plot
})
#NEW PLOT
ayfp_mod_res <- reactive({
res <- ayfp %>% select(2,8, 9) %>% filter(ayfp$Country == input$country)
req(nrow(res) > 0)
res$`15-19` <- res$`MCPR for unmarried sexually active adolescents (15-19)**`
res$`20-24` <- res$`MCPR for unmarried sexually active youth (20-24)**`
res.long <- res %>% gather("Age.Group", "Percent", "15-19" , "20-24")
res.long
})
output$mod_con <- renderPlot({
fig <- (ggplot(ayfp_mod_res(), aes(x= reorder(`Age.Group`, -`Percent`), y = `Percent`, fill = `Age.Group`)) + geom_bar(stat = "identity"))
fig + coord_flip() + theme_classic() + geom_text(aes(label=`Percent`), color="black", size=3.5) +
labs( subtitle = "Unmarried Sexually Active %") +
scale_fill_manual(values = cbp3, name = "Age Group") +
theme(axis.line.y=element_blank(),
axis.text.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.ticks.y=element_blank(),
axis.text.x =element_blank(),
axis.ticks.x =element_blank(),
axis.line.x =element_blank(),
legend.position = "bottom")
})
#END PLOT
### NEW PLOT Modern Contraceptive Use: Married Women
#Notes: Fix Decimal Points
ayfp_mod_marr<- reactive({
res <- ayfp %>% select(2,10, 11, 12) %>% filter(ayfp$Country == input$country)
req(nrow(res) > 0)
res$`15-19` <- res$`MCPR for married adolescents (15-19)`
res$`20-24` <- res$`MCPR for married youth (20-24)`
res$`15-24` <- res$`MCPR for married adolescent and youth (15-24)`
res.long <- res %>% gather("Age.Group", "Percent", "15-19" , "20-24", "15-24")
res.long
})
output$mod_marr <- renderPlot({
fig <- (ggplot(ayfp_mod_marr(), aes(x= reorder(`Age.Group`, -`Percent`), y = `Percent`, fill = `Age.Group`)) + geom_bar(stat = "identity"))
fig + coord_flip() + theme_classic() + geom_text(aes(label= round(`Percent`,1)), color="black", size=3.5) +
labs(subtitle = "Married Women %") +
scale_fill_manual(values = cbp5, name = "Age Group") +
theme(axis.line.y=element_blank(),
axis.text.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.ticks.y=element_blank(),
axis.text.x =element_blank(),
axis.ticks.x =element_blank(),
axis.line.x =element_blank(),
legend.position = "bottom")
})
#END PLOT
#NEW PLOT
#CONDOM USE AT LAST SEX
ayfp_con_res<- reactive({
res <- ayfp %>% select(2,29) %>% filter(ayfp$Country == input$country)
req(nrow(res) > 0)
res$`15-24` <- res$`Condom use during last sex: 15-24 year olds`
res.long <- res %>% gather("Age.Group", "Percent", "15-24")
})
output$con_use <- renderPlot({
fig <- (ggplot(ayfp_con_res(), aes(x= reorder(`Age.Group`, -`Percent`), y = `Percent`, fill = `Age.Group`)) + geom_bar(stat = "identity"))
fig + coord_flip() + theme_classic() + geom_text(aes(label=`Percent`), color="black", size=3.5) +
labs(subtitle = "Condom Use During Last Sex %") +
scale_fill_manual(values = cbp4, name = "Age Group") +
theme(axis.line.y=element_blank(),
axis.text.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.ticks.y=element_blank(),
axis.text.x =element_blank(),
axis.ticks.x =element_blank(),
axis.line.x =element_blank(),
legend.position = "bottom")
})
#TRADITIONAL USE PLOTS START
#NEW PLOT: UNMARRIED SEXUALLY ACTIVE
ayfp_trad_unmarr<- reactive({
res <- ayfp %>% select(2,13,14) %>% filter(ayfp$Country == input$country)
req(nrow(res) > 0)
res$`15-19` <- res$`% of unmarried sexually active** older adolescents aged 15-19 using a traditional method`
res$`20-24` <- res$`% of unmarried sexually active** older youth aged 20-24 using a traditional method`
res.long <- res %>% gather("Age.Group", "Percent", "15-19", "20-24")
})
output$trad_unmarr <- renderPlot({
fig <- (ggplot(ayfp_trad_unmarr(), aes(x= reorder(`Age.Group`, -`Percent`), y = `Percent`, fill = `Age.Group`)) + geom_bar(stat = "identity"))
fig + coord_flip() + theme_classic() + geom_text(aes(label=`Percent`), color="black", size=3.5) +
labs(subtitle = "Unmarried Sexually Active %") +
scale_fill_manual(values = cbp3, name = "Age Group") +
theme(axis.line.y=element_blank(),
axis.text.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.ticks.y=element_blank(),
axis.text.x =element_blank(),
axis.ticks.x =element_blank(),
axis.line.x =element_blank(),
legend.position = "bottom")
})
#NEW PLOT
ayfp_trad_marr<- reactive({
res <- ayfp %>% select(2,15,16,17) %>% filter(ayfp$Country == input$country)
req(nrow(res) > 0)
res$`15-19` <- res$`% of married older adolescents aged 15-19 using a traditional method`
res$`20-24` <- res$`% of married older youth aged 20-24 using a traditional method`
res$`15-24` <- res$`% of married youth aged 15-24 using a traditional method`
res.long <- res %>% gather("Age.Group", "Percent", "15-19", "20-24", "15-24")
})
output$trad_marr <- renderPlot({
fig <- (ggplot(ayfp_trad_marr(), aes(x= reorder(`Age.Group`, -`Percent`), y = `Percent`, fill = `Age.Group`)) + geom_bar(stat = "identity"))
fig + coord_flip() + theme_classic() + geom_text(aes(label=`Percent`), color="black", size=3.5) +
labs(subtitle = "Married Sexually Active %") +
scale_fill_manual(values = cbp5, name = "Age Group") +
theme(axis.line.y=element_blank(),
axis.text.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.ticks.y=element_blank(),
axis.text.x =element_blank(),
axis.ticks.x =element_blank(),
axis.line.x =element_blank(),
legend.position = "bottom")
})
}
# Run the application
shinyApp(ui = ui, server = server)
runApp('ay')
